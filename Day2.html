<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

<title>Day 2</title>

<!-- Styles for R syntax highlighter -->
<style type="text/css">
   pre .operator,
   pre .paren {
     color: rgb(104, 118, 135)
   }

   pre .literal {
     color: rgb(88, 72, 246)
   }

   pre .number {
     color: rgb(0, 0, 205);
   }

   pre .comment {
     color: rgb(76, 136, 107);
   }

   pre .keyword {
     color: rgb(0, 0, 255);
   }

   pre .identifier {
     color: rgb(0, 0, 0);
   }

   pre .string {
     color: rgb(3, 106, 7);
   }
</style>

<!-- R syntax highlighter -->
<script type="text/javascript">
var hljs=new function(){function m(p){return p.replace(/&/gm,"&amp;").replace(/</gm,"&lt;")}function f(r,q,p){return RegExp(q,"m"+(r.cI?"i":"")+(p?"g":""))}function b(r){for(var p=0;p<r.childNodes.length;p++){var q=r.childNodes[p];if(q.nodeName=="CODE"){return q}if(!(q.nodeType==3&&q.nodeValue.match(/\s+/))){break}}}function h(t,s){var p="";for(var r=0;r<t.childNodes.length;r++){if(t.childNodes[r].nodeType==3){var q=t.childNodes[r].nodeValue;if(s){q=q.replace(/\n/g,"")}p+=q}else{if(t.childNodes[r].nodeName=="BR"){p+="\n"}else{p+=h(t.childNodes[r])}}}if(/MSIE [678]/.test(navigator.userAgent)){p=p.replace(/\r/g,"\n")}return p}function a(s){var r=s.className.split(/\s+/);r=r.concat(s.parentNode.className.split(/\s+/));for(var q=0;q<r.length;q++){var p=r[q].replace(/^language-/,"");if(e[p]){return p}}}function c(q){var p=[];(function(s,t){for(var r=0;r<s.childNodes.length;r++){if(s.childNodes[r].nodeType==3){t+=s.childNodes[r].nodeValue.length}else{if(s.childNodes[r].nodeName=="BR"){t+=1}else{if(s.childNodes[r].nodeType==1){p.push({event:"start",offset:t,node:s.childNodes[r]});t=arguments.callee(s.childNodes[r],t);p.push({event:"stop",offset:t,node:s.childNodes[r]})}}}}return t})(q,0);return p}function k(y,w,x){var q=0;var z="";var s=[];function u(){if(y.length&&w.length){if(y[0].offset!=w[0].offset){return(y[0].offset<w[0].offset)?y:w}else{return w[0].event=="start"?y:w}}else{return y.length?y:w}}function t(D){var A="<"+D.nodeName.toLowerCase();for(var B=0;B<D.attributes.length;B++){var C=D.attributes[B];A+=" "+C.nodeName.toLowerCase();if(C.value!==undefined&&C.value!==false&&C.value!==null){A+='="'+m(C.value)+'"'}}return A+">"}while(y.length||w.length){var v=u().splice(0,1)[0];z+=m(x.substr(q,v.offset-q));q=v.offset;if(v.event=="start"){z+=t(v.node);s.push(v.node)}else{if(v.event=="stop"){var p,r=s.length;do{r--;p=s[r];z+=("</"+p.nodeName.toLowerCase()+">")}while(p!=v.node);s.splice(r,1);while(r<s.length){z+=t(s[r]);r++}}}}return z+m(x.substr(q))}function j(){function q(x,y,v){if(x.compiled){return}var u;var s=[];if(x.k){x.lR=f(y,x.l||hljs.IR,true);for(var w in x.k){if(!x.k.hasOwnProperty(w)){continue}if(x.k[w] instanceof Object){u=x.k[w]}else{u=x.k;w="keyword"}for(var r in u){if(!u.hasOwnProperty(r)){continue}x.k[r]=[w,u[r]];s.push(r)}}}if(!v){if(x.bWK){x.b="\\b("+s.join("|")+")\\s"}x.bR=f(y,x.b?x.b:"\\B|\\b");if(!x.e&&!x.eW){x.e="\\B|\\b"}if(x.e){x.eR=f(y,x.e)}}if(x.i){x.iR=f(y,x.i)}if(x.r===undefined){x.r=1}if(!x.c){x.c=[]}x.compiled=true;for(var t=0;t<x.c.length;t++){if(x.c[t]=="self"){x.c[t]=x}q(x.c[t],y,false)}if(x.starts){q(x.starts,y,false)}}for(var p in e){if(!e.hasOwnProperty(p)){continue}q(e[p].dM,e[p],true)}}function d(B,C){if(!j.called){j();j.called=true}function q(r,M){for(var L=0;L<M.c.length;L++){if((M.c[L].bR.exec(r)||[null])[0]==r){return M.c[L]}}}function v(L,r){if(D[L].e&&D[L].eR.test(r)){return 1}if(D[L].eW){var M=v(L-1,r);return M?M+1:0}return 0}function w(r,L){return L.i&&L.iR.test(r)}function K(N,O){var M=[];for(var L=0;L<N.c.length;L++){M.push(N.c[L].b)}var r=D.length-1;do{if(D[r].e){M.push(D[r].e)}r--}while(D[r+1].eW);if(N.i){M.push(N.i)}return f(O,M.join("|"),true)}function p(M,L){var N=D[D.length-1];if(!N.t){N.t=K(N,E)}N.t.lastIndex=L;var r=N.t.exec(M);return r?[M.substr(L,r.index-L),r[0],false]:[M.substr(L),"",true]}function z(N,r){var L=E.cI?r[0].toLowerCase():r[0];var M=N.k[L];if(M&&M instanceof Array){return M}return false}function F(L,P){L=m(L);if(!P.k){return L}var r="";var O=0;P.lR.lastIndex=0;var M=P.lR.exec(L);while(M){r+=L.substr(O,M.index-O);var N=z(P,M);if(N){x+=N[1];r+='<span class="'+N[0]+'">'+M[0]+"</span>"}else{r+=M[0]}O=P.lR.lastIndex;M=P.lR.exec(L)}return r+L.substr(O,L.length-O)}function J(L,M){if(M.sL&&e[M.sL]){var r=d(M.sL,L);x+=r.keyword_count;return r.value}else{return F(L,M)}}function I(M,r){var L=M.cN?'<span class="'+M.cN+'">':"";if(M.rB){y+=L;M.buffer=""}else{if(M.eB){y+=m(r)+L;M.buffer=""}else{y+=L;M.buffer=r}}D.push(M);A+=M.r}function G(N,M,Q){var R=D[D.length-1];if(Q){y+=J(R.buffer+N,R);return false}var P=q(M,R);if(P){y+=J(R.buffer+N,R);I(P,M);return P.rB}var L=v(D.length-1,M);if(L){var O=R.cN?"</span>":"";if(R.rE){y+=J(R.buffer+N,R)+O}else{if(R.eE){y+=J(R.buffer+N,R)+O+m(M)}else{y+=J(R.buffer+N+M,R)+O}}while(L>1){O=D[D.length-2].cN?"</span>":"";y+=O;L--;D.length--}var r=D[D.length-1];D.length--;D[D.length-1].buffer="";if(r.starts){I(r.starts,"")}return R.rE}if(w(M,R)){throw"Illegal"}}var E=e[B];var D=[E.dM];var A=0;var x=0;var y="";try{var s,u=0;E.dM.buffer="";do{s=p(C,u);var t=G(s[0],s[1],s[2]);u+=s[0].length;if(!t){u+=s[1].length}}while(!s[2]);if(D.length>1){throw"Illegal"}return{r:A,keyword_count:x,value:y}}catch(H){if(H=="Illegal"){return{r:0,keyword_count:0,value:m(C)}}else{throw H}}}function g(t){var p={keyword_count:0,r:0,value:m(t)};var r=p;for(var q in e){if(!e.hasOwnProperty(q)){continue}var s=d(q,t);s.language=q;if(s.keyword_count+s.r>r.keyword_count+r.r){r=s}if(s.keyword_count+s.r>p.keyword_count+p.r){r=p;p=s}}if(r.language){p.second_best=r}return p}function i(r,q,p){if(q){r=r.replace(/^((<[^>]+>|\t)+)/gm,function(t,w,v,u){return w.replace(/\t/g,q)})}if(p){r=r.replace(/\n/g,"<br>")}return r}function n(t,w,r){var x=h(t,r);var v=a(t);var y,s;if(v){y=d(v,x)}else{return}var q=c(t);if(q.length){s=document.createElement("pre");s.innerHTML=y.value;y.value=k(q,c(s),x)}y.value=i(y.value,w,r);var u=t.className;if(!u.match("(\\s|^)(language-)?"+v+"(\\s|$)")){u=u?(u+" "+v):v}if(/MSIE [678]/.test(navigator.userAgent)&&t.tagName=="CODE"&&t.parentNode.tagName=="PRE"){s=t.parentNode;var p=document.createElement("div");p.innerHTML="<pre><code>"+y.value+"</code></pre>";t=p.firstChild.firstChild;p.firstChild.cN=s.cN;s.parentNode.replaceChild(p.firstChild,s)}else{t.innerHTML=y.value}t.className=u;t.result={language:v,kw:y.keyword_count,re:y.r};if(y.second_best){t.second_best={language:y.second_best.language,kw:y.second_best.keyword_count,re:y.second_best.r}}}function o(){if(o.called){return}o.called=true;var r=document.getElementsByTagName("pre");for(var p=0;p<r.length;p++){var q=b(r[p]);if(q){n(q,hljs.tabReplace)}}}function l(){if(window.addEventListener){window.addEventListener("DOMContentLoaded",o,false);window.addEventListener("load",o,false)}else{if(window.attachEvent){window.attachEvent("onload",o)}else{window.onload=o}}}var e={};this.LANGUAGES=e;this.highlight=d;this.highlightAuto=g;this.fixMarkup=i;this.highlightBlock=n;this.initHighlighting=o;this.initHighlightingOnLoad=l;this.IR="[a-zA-Z][a-zA-Z0-9_]*";this.UIR="[a-zA-Z_][a-zA-Z0-9_]*";this.NR="\\b\\d+(\\.\\d+)?";this.CNR="\\b(0[xX][a-fA-F0-9]+|(\\d+(\\.\\d*)?|\\.\\d+)([eE][-+]?\\d+)?)";this.BNR="\\b(0b[01]+)";this.RSR="!|!=|!==|%|%=|&|&&|&=|\\*|\\*=|\\+|\\+=|,|\\.|-|-=|/|/=|:|;|<|<<|<<=|<=|=|==|===|>|>=|>>|>>=|>>>|>>>=|\\?|\\[|\\{|\\(|\\^|\\^=|\\||\\|=|\\|\\||~";this.ER="(?![\\s\\S])";this.BE={b:"\\\\.",r:0};this.ASM={cN:"string",b:"'",e:"'",i:"\\n",c:[this.BE],r:0};this.QSM={cN:"string",b:'"',e:'"',i:"\\n",c:[this.BE],r:0};this.CLCM={cN:"comment",b:"//",e:"$"};this.CBLCLM={cN:"comment",b:"/\\*",e:"\\*/"};this.HCM={cN:"comment",b:"#",e:"$"};this.NM={cN:"number",b:this.NR,r:0};this.CNM={cN:"number",b:this.CNR,r:0};this.BNM={cN:"number",b:this.BNR,r:0};this.inherit=function(r,s){var p={};for(var q in r){p[q]=r[q]}if(s){for(var q in s){p[q]=s[q]}}return p}}();hljs.LANGUAGES.cpp=function(){var a={keyword:{"false":1,"int":1,"float":1,"while":1,"private":1,"char":1,"catch":1,"export":1,virtual:1,operator:2,sizeof:2,dynamic_cast:2,typedef:2,const_cast:2,"const":1,struct:1,"for":1,static_cast:2,union:1,namespace:1,unsigned:1,"long":1,"throw":1,"volatile":2,"static":1,"protected":1,bool:1,template:1,mutable:1,"if":1,"public":1,friend:2,"do":1,"return":1,"goto":1,auto:1,"void":2,"enum":1,"else":1,"break":1,"new":1,extern:1,using:1,"true":1,"class":1,asm:1,"case":1,typeid:1,"short":1,reinterpret_cast:2,"default":1,"double":1,register:1,explicit:1,signed:1,typename:1,"try":1,"this":1,"switch":1,"continue":1,wchar_t:1,inline:1,"delete":1,alignof:1,char16_t:1,char32_t:1,constexpr:1,decltype:1,noexcept:1,nullptr:1,static_assert:1,thread_local:1,restrict:1,_Bool:1,complex:1},built_in:{std:1,string:1,cin:1,cout:1,cerr:1,clog:1,stringstream:1,istringstream:1,ostringstream:1,auto_ptr:1,deque:1,list:1,queue:1,stack:1,vector:1,map:1,set:1,bitset:1,multiset:1,multimap:1,unordered_set:1,unordered_map:1,unordered_multiset:1,unordered_multimap:1,array:1,shared_ptr:1}};return{dM:{k:a,i:"</",c:[hljs.CLCM,hljs.CBLCLM,hljs.QSM,{cN:"string",b:"'\\\\?.",e:"'",i:"."},{cN:"number",b:"\\b(\\d+(\\.\\d*)?|\\.\\d+)(u|U|l|L|ul|UL|f|F)"},hljs.CNM,{cN:"preprocessor",b:"#",e:"$"},{cN:"stl_container",b:"\\b(deque|list|queue|stack|vector|map|set|bitset|multiset|multimap|unordered_map|unordered_set|unordered_multiset|unordered_multimap|array)\\s*<",e:">",k:a,r:10,c:["self"]}]}}}();hljs.LANGUAGES.r={dM:{c:[hljs.HCM,{cN:"number",b:"\\b0[xX][0-9a-fA-F]+[Li]?\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\b\\d+(?:[eE][+\\-]?\\d*)?L\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\b\\d+\\.(?!\\d)(?:i\\b)?",e:hljs.IMMEDIATE_RE,r:1},{cN:"number",b:"\\b\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d*)?i?\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\.\\d+(?:[eE][+\\-]?\\d*)?i?\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"keyword",b:"(?:tryCatch|library|setGeneric|setGroupGeneric)\\b",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\.\\.\\.",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\.\\.\\d+(?![\\w.])",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\b(?:function)",e:hljs.IMMEDIATE_RE,r:2},{cN:"keyword",b:"(?:if|in|break|next|repeat|else|for|return|switch|while|try|stop|warning|require|attach|detach|source|setMethod|setClass)\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"literal",b:"(?:NA|NA_integer_|NA_real_|NA_character_|NA_complex_)\\b",e:hljs.IMMEDIATE_RE,r:10},{cN:"literal",b:"(?:NULL|TRUE|FALSE|T|F|Inf|NaN)\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"identifier",b:"[a-zA-Z.][a-zA-Z0-9._]*\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"operator",b:"<\\-(?!\\s*\\d)",e:hljs.IMMEDIATE_RE,r:2},{cN:"operator",b:"\\->|<\\-",e:hljs.IMMEDIATE_RE,r:1},{cN:"operator",b:"%%|~",e:hljs.IMMEDIATE_RE},{cN:"operator",b:">=|<=|==|!=|\\|\\||&&|=|\\+|\\-|\\*|/|\\^|>|<|!|&|\\||\\$|:",e:hljs.IMMEDIATE_RE,r:0},{cN:"operator",b:"%",e:"%",i:"\\n",r:1},{cN:"identifier",b:"`",e:"`",r:0},{cN:"string",b:'"',e:'"',c:[hljs.BE],r:0},{cN:"string",b:"'",e:"'",c:[hljs.BE],r:0},{cN:"paren",b:"[[({\\])}]",e:hljs.IMMEDIATE_RE,r:0}]}};
hljs.initHighlightingOnLoad();
</script>

<!-- MathJax scripts -->
<script type="text/javascript" src="https://c328740.ssl.cf1.rackcdn.com/mathjax/2.0-latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


<style type="text/css">
body, td {
   font-family: sans-serif;
   background-color: white;
   font-size: 12px;
   margin: 8px;
}

tt, code, pre {
   font-family: 'DejaVu Sans Mono', 'Droid Sans Mono', 'Lucida Console', Consolas, Monaco, monospace;
}

h1 { 
   font-size:2.2em; 
}

h2 { 
   font-size:1.8em; 
}

h3 { 
   font-size:1.4em; 
}

h4 { 
   font-size:1.0em; 
}

h5 { 
   font-size:0.9em; 
}

h6 { 
   font-size:0.8em; 
}

a:visited {
   color: rgb(50%, 0%, 50%);
}

pre {	
   margin-top: 0;
   max-width: 95%;
   border: 1px solid #ccc;
   white-space: pre-wrap;
}

pre code {
   display: block; padding: 0.5em;
}

code.r, code.cpp {
   background-color: #F8F8F8;
}

table, td, th {
  border: none;
}

blockquote {
   color:#666666;
   margin:0;
   padding-left: 1em;
   border-left: 0.5em #EEE solid;
}

hr {
   height: 0px;
   border-bottom: none;
   border-top-width: thin;
   border-top-style: dotted;
   border-top-color: #999999;
}

@media print {
   * { 
      background: transparent !important; 
      color: black !important; 
      filter:none !important; 
      -ms-filter: none !important; 
   }

   body { 
      font-size:12pt; 
      max-width:100%; 
   }
       
   a, a:visited { 
      text-decoration: underline; 
   }

   hr { 
      visibility: hidden;
      page-break-before: always;
   }

   pre, blockquote { 
      padding-right: 1em; 
      page-break-inside: avoid; 
   }

   tr, img { 
      page-break-inside: avoid; 
   }

   img { 
      max-width: 100% !important; 
   }

   @page :left { 
      margin: 15mm 20mm 15mm 10mm; 
   }
     
   @page :right { 
      margin: 15mm 10mm 15mm 20mm; 
   }

   p, h2, h3 { 
      orphans: 3; widows: 3; 
   }

   h2, h3 { 
      page-break-after: avoid; 
   }
}
</style>



</head>

<body>
<h1>Day 2</h1>

<h2>Review</h2>

<p>Assignment review: make a dataset that derives from sample_data and lgas.csv, to create a list of facilities in the Southern zone of Nigeria, as well as the pop_2006 column per LGA. The end results should have 26 rows and 11 columns.</p>

<ul>
<li>Can someone write out the steps necessary?</li>
<li>How do we do the subsetting?</li>
<li>How do we choose the column to merge by? If you chose <code>lga</code>, not <code>lga_id</code>, do you see any potential issues?</li>
<li>Notice that we wanted the output to only have 11 columns. Did you do the subset before or after merging? For anyone who did it later, what happened to the redundant columns?</li>
</ul>

<h2>Today</h2>

<ul>
<li>Adding and removing columns</li>
<li>Creating new data.frames using R: <code>data.frame</code></li>
<li>Aggregations in R</li>
<li>Some basic visualizations tools and techniques</li>
<li>Introduction to ggplot2</li>
</ul>

<h2>Adding and removing columns to a data.frame</h2>

<p>First, lets play a guessing game. Yesterday we learned about the bracket notation in R, but we always have a comma inside the bracket. (Question: what does <code>sample_data[1,5]</code> give you?) What do you think happens when you do <code>sample_data[1]</code>?</p>

<pre><code class="r">sample_data &lt;- read.csv(&quot;sample_health_facilities.csv&quot;)
# What do you think sample_data[1] returns?
</code></pre>

<p>Recall that a data.frame is a &ldquo;rectangular&rdquo; object, some number of rows and some number of columns, where each column has the same type. Because each column has the same type, it makes sense to do statistics over columns more often than rows, many data.frame functions are &ldquo;column-first&rdquo;. Lets learn how to add and remove columns from a <code>data.frame</code> object:</p>

<p>Note that sample_data data.frame has 50 rows. So we can construct a 50 row vector to insert as an additional column to the data.frame, and assign it to a column. Its as simple as that!</p>

<pre><code class="r">sample_data$one_to_fifty &lt;- 1:50
head(sample_data[8:11])  # show the head of the last 4 columns
</code></pre>

<pre><code>##   num_lab_techs_fulltime management num_doctors_fulltime one_to_fifty
## 1                      1     public                    0            1
## 2                     NA     public                   NA            2
## 3                      1     public                    0            3
## 4                      0     public                    0            4
## 5                      0     public                    0            5
## 6                      1     public                    1            6
</code></pre>

<p>Sometimes, you need your dataset to have a constant value. For example, you may want to add a constant column called &ldquo;country&rdquo; to your dataset, or maybe it is &ldquo;sector&rdquo; (as in, health vs. education vs. water). R makes column creation very straightforward by repeating a value (in R language, this is known as &ldquo;broadcasting&rdquo;). When you need a whole column created with the same value, you can use this type of &ldquo;broadcasting&rdquo;.</p>

<pre><code class="r">sample_data$country &lt;- &quot;Nigeria&quot;
head(sample_data[8:12])
</code></pre>

<pre><code>##   num_lab_techs_fulltime management num_doctors_fulltime one_to_fifty
## 1                      1     public                    0            1
## 2                     NA     public                   NA            2
## 3                      1     public                    0            3
## 4                      0     public                    0            4
## 5                      0     public                    0            5
## 6                      1     public                    1            6
##   country
## 1 Nigeria
## 2 Nigeria
## 3 Nigeria
## 4 Nigeria
## 5 Nigeria
## 6 Nigeria
</code></pre>

<p>Creating a column from a single value. R allows the user to broadcast numerical values as well:</p>

<pre><code class="r">sample_data$ONE &lt;- 1
head(sample_data[8:13])
</code></pre>

<pre><code>##   num_lab_techs_fulltime management num_doctors_fulltime one_to_fifty
## 1                      1     public                    0            1
## 2                     NA     public                   NA            2
## 3                      1     public                    0            3
## 4                      0     public                    0            4
## 5                      0     public                    0            5
## 6                      1     public                    1            6
##   country ONE
## 1 Nigeria   1
## 2 Nigeria   1
## 3 Nigeria   1
## 4 Nigeria   1
## 5 Nigeria   1
## 6 Nigeria   1
</code></pre>

<p>You can also create columns using other columns. Many functions in R are &ldquo;vectorized&rdquo;, as in, they work on vectors the same as they work on single values (sometimes called scalars). See, for example, the add (+) function below:</p>

<pre><code class="r">1 + 2
</code></pre>

<pre><code>## [1] 3
</code></pre>

<pre><code class="r">1:5 + 6:10
</code></pre>

<pre><code>## [1]  7  9 11 13 15
</code></pre>

<pre><code class="r">head(sample_data[, c(&quot;num_nurses_fulltime&quot;, &quot;num_doctors_fulltime&quot;)])
</code></pre>

<pre><code>##   num_nurses_fulltime num_doctors_fulltime
## 1                   0                    0
## 2                   2                   NA
## 3                   1                    0
## 4                   0                    0
## 5                   0                    0
## 6                   0                    1
</code></pre>

<pre><code class="r">sample_data$skilled_birth_attendants &lt;- sample_data$num_nurses_fulltime + sample_data$num_doctors_fulltime
head(sample_data[, c(&quot;num_nurses_fulltime&quot;, &quot;num_doctors_fulltime&quot;, &quot;skilled_birth_attendants&quot;)])
</code></pre>

<pre><code>##   num_nurses_fulltime num_doctors_fulltime skilled_birth_attendants
## 1                   0                    0                        0
## 2                   2                   NA                       NA
## 3                   1                    0                        1
## 4                   0                    0                        0
## 5                   0                    0                        0
## 6                   0                    1                        1
</code></pre>

<p>Notice the NA issue. Depending on what that NA means, we may want to zero it out when doing this addition, or leave it as NA. We will get to this topic later on.</p>

<p>Often, we want to create boolean columns in our dataset, for many reasons. We can do this with any function that creates a boolean vector:</p>

<pre><code class="r">sample_data$public &lt;- sample_data$management == &quot;public&quot;
head(sample_data[, c(&quot;management&quot;, &quot;public&quot;)])
</code></pre>

<pre><code>##   management public
## 1     public   TRUE
## 2     public   TRUE
## 3     public   TRUE
## 4     public   TRUE
## 5     public   TRUE
## 6     public   TRUE
</code></pre>

<pre><code class="r">
sample_data$is_public_facility_with_doctor &lt;- sample_data$management == &quot;public&quot; &amp; 
    sample_data$num_doctors_fulltime &gt; 0
head(sample_data[, c(&quot;is_public_facility_with_doctor&quot;, &quot;management&quot;, &quot;num_doctors_fulltime&quot;)])
</code></pre>

<pre><code>##   is_public_facility_with_doctor management num_doctors_fulltime
## 1                          FALSE     public                    0
## 2                             NA     public                   NA
## 3                          FALSE     public                    0
## 4                          FALSE     public                    0
## 5                          FALSE     public                    0
## 6                           TRUE     public                    1
</code></pre>

<p>CAUTION: When you use boolean operators, be sure to use <code>&amp;</code> and <code>!</code>, not <code>&amp;&amp;</code> and <code>||</code>. <code>&amp;&amp;</code> and <code>||</code> are NOT vectorized:</p>

<pre><code class="r">c(FALSE, TRUE) &amp; c(TRUE, TRUE)
</code></pre>

<pre><code>## [1] FALSE  TRUE
</code></pre>

<pre><code class="r">c(TRUE, FALSE) &amp;&amp; c(TRUE, TRUE)
</code></pre>

<pre><code>## [1] TRUE
</code></pre>

<p>You can also &ldquo;create&rdquo; a new column by renaming an old one:</p>

<pre><code class="r"># for the second argument: quote the current variable name, and set it equal
# the quoted desired name
sample_data &lt;- rename(sample_data, c(gps = &quot;global_positioning_system&quot;))
</code></pre>

<pre><code>## Error: could not find function &quot;rename&quot;
</code></pre>

<pre><code class="r">names(sample_data)
</code></pre>

<pre><code>##  [1] &quot;lga&quot;                            &quot;lga_id&quot;                        
##  [3] &quot;state&quot;                          &quot;zone&quot;                          
##  [5] &quot;c_section_yn&quot;                   &quot;num_nurses_fulltime&quot;           
##  [7] &quot;gps&quot;                            &quot;num_lab_techs_fulltime&quot;        
##  [9] &quot;management&quot;                     &quot;num_doctors_fulltime&quot;          
## [11] &quot;one_to_fifty&quot;                   &quot;country&quot;                       
## [13] &quot;ONE&quot;                            &quot;skilled_birth_attendants&quot;      
## [15] &quot;public&quot;                         &quot;is_public_facility_with_doctor&quot;
</code></pre>

<p>One way to removing column is to set the column to NULL. </p>

<pre><code class="r">sample_data$is_public_facility_with_doctor &lt;- NULL
</code></pre>

<p>Questions: </p>

<ul>
<li>How would you check to make sure that the column no longer exists?</li>
<li>What is another way that we learned in Day 1 that also allows for column deletion?</li>
</ul>

<h4>Exercise:</h4>

<ul>
<li>Create a new column in sample_data that goes from ten down to 1. Call it <code>descending_row_name</code>.</li>
<li>Create a new column, called <code>even_and_no_doctor</code>, which is TRUE if <code>descending_row_name</code> is odd, and there is a doctor in that facility.</li>
<li>Hint: Type in <code>10:1 %% 2</code> into the R console. What do you get? %% is the &ldquo;mod&rdquo; operator, it outputs the remainder when you divide a number by another. Example, <code>5 %% 2</code> is 1, <code>4 %% 2</code> is 0</li>
<li>You can check your answer; there should be 31 FALSE and 19 TRUE values.</li>
</ul>

<p>One final note regarding column creation; be careful about broadcasting. R will broadcast things that you may not expect it to. For example, what do you think will happen if you type in <code>sample_data$one_two &lt;- c(1:2)</code>. What happened?</p>

<h2>Creating new data.frames using R: <code>data.frame</code> function</h2>

<p>So far, we have created dataframes by reading in csv files. You can also create your data frame using R code. Example:</p>

<pre><code class="r">data.frame(a = c(1, 2, 3), b = c(10, 20, 30))
</code></pre>

<pre><code>##   a  b
## 1 1 10
## 2 2 20
## 3 3 30
</code></pre>

<p>What is a? What is b? What did we do?</p>

<p>As always, you can also use existing data:</p>

<pre><code class="r">data.frame(a = &quot;Nigeria&quot;, b = head(sample_data)$num_doctors_fulltime * 5)
</code></pre>

<pre><code>##         a  b
## 1 Nigeria  0
## 2 Nigeria NA
## 3 Nigeria  0
## 4 Nigeria  0
## 5 Nigeria  0
## 6 Nigeria  5
</code></pre>

<h2>Aggregations in R:</h2>

<p>There are many functions that can do aggregations for you in R; we will cover <code>ddply()</code> from the <code>plyr</code> package in this tutorial. This is also the function that we have found most useful when writing aggregate indicators for NMIS.</p>

<h1>* creating simple aggregated summary:</h1>

<h1>* note:</h1>

<h1>1. <strong>(group) by</strong> variable must have at least one input</h1>

<h1>2. you <strong>must</strong> specify what type of aggregation you want to perform, choose one from: summarize, transform</h1>

<h1>* <a href="http://cran.r-project.org/web/packages/plyr/plyr.pdf">the link to the package dodument</a></h1>

<p>sample_data &lt;- read.csv(&ldquo;./sample_health_facilities.csv&rdquo;)</p>

<p>library(plyr)
my_summary &lt;- ddply(sample_data, .(state, lga), summarise, 
                    counts = length(lga_id),
                    total_num_nurse = sum(num_nurses_fulltime, na.rm=T),
                    avg_c_section = mean(c_section_yn == T,na.rm=T))
head(my_summary)</p>

<h1>ddply could take by variable in string format which is very handy when you want to use it in a function</h1>

<p>my_summary &lt;- ddply(sample_data, c(&ldquo;state&rdquo;, &ldquo;lga&rdquo;), summarise, 
                    counts = length(lga_id),
                    total_num_nurse = sum(num_nurses_fulltime, na.rm=T),
                    avg_c_section = mean(c_section_yn == T,na.rm=T))
head(my_summary)</p>

<h1>* look at the output and compare the difference, the only change here is replacing summarize with transform</h1>

<p>my_summary &lt;- ddply(sample_data, .(state, lga), transform, 
                    counts = length(lga_id),
                    total_num_nurse = sum(num_nurses_fulltime, na.rm=T),
                    avg_c_section = mean(c_section_yn == T,na.rm=T))
head(my_summary)</p>

<h1>define your own function in ddply</h1>

<h1>the syntax is pretty much the same as defining functions in R, except</h1>

<h1>it is CRITICAL to add data.frame() function so that it returns a data.frame</h1>

<h1>for each small chunk of data splitted by ddply()</h1>

<p>my_summary &lt;- ddply(sample_data, .(state), function(df){
                                            data.frame(
                                              unique_lga_number = nrow(df),
                                              avg_c_section = mean(df$c_section_yn == T,na.rm=T),
                                              avg_c_section_true = length(which(df$c_section_yn))
                                            )
                                            })</p>

<h1>idata.frame</h1>

<h1>If you have HUGE amount of data for ddply to aggregate and you find it annoying to wait a long time before seeing the result</h1>

<h1>idata.frame is the solution to this, but it comes with the cost of slightly complicated code.</h1>

<p>count(sample_data$c_section_yn == T)</p>

</body>

</html>
