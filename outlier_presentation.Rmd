<link href="http://kevinburke.bitbucket.org/markdowncss/markdown.css" rel="stylesheet"></link>

Outlier Cleaning
========================================================

Outliers were thoroughly cleaned from the NMIS data set before running the analysis portion of our R scripts. In this section, we will explore both the outlier __detection__ and __replacement__ processes.  

#### Reading in Our Special Data: RDS files
Please download the pre-outlier cleaned education data set here 
[dropbox link for educaiton data](https://www.dropbox.com/s/plojzyei3g3layi/Education_774_normalized.rds).

As you can see, the file you downloaded is in .RDS format. This file type can only be opened using R. The main purpouse for this file format is __speed__. R reads in and writes out .RDS files significantly faster than any other file type, which is important when working with larger data sets such as NMIS.

Let's take this opportunity now to learn two new commands that are nearly identical to __read.csv__ and __write.csv__. 
```{r, cache=TRUE, eval=FALSE}
edu_normalized <- readRDS("~/Dropbox/Nigeria/Nigeria 661 Baseline Data Cleaning/in_process_data/Normalized/Education_774_normalized.rds")
```

```{r, eval=FALSE}
saveRDS(edu_normalized, "~/Desktop/Education_Normalized_unchanged.RDS")
```

#### Outlier Detection Example
Let's begin be seeing a simple example of outlier removal using logic Checks. Frequently, we run basic logic checks on the data as part of the cleaning process.

```{r, cache=TRUE}
edu_normalized <- outlierreplace(edu_normalized, 'num_tchrs_male', 
                    (edu_normalized$num_tchrs_male > edu_normalized$num_tchrs_total))
```

#### The Function: __outlierreplace()__

Now that you've seen an example of the function, let's step back and break down the `outlierreplace` function line by line. Because our functions are not in an official R package, you cannot access the help manual as you learned in Day 1.   

```{r, cache=TRUE}
#stringr library is necessary for our function
library(stringr)

#the function
outlierreplace = function(df, c, rowpredicate, replaceVal=NA) {
  naCount1 <- sum(is.na(df[,c]))
  df[,c] <- replace(df[,c], rowpredicate, replaceVal)
  naCount2 <- sum(is.na(df[,c]))
  print(str_c(naCount2-naCount1, " outliers replaced for field: ", c)) 
  df
}

head(edu_normalized$num_tchrs_male > edu_normalized$num_tchrs_total)

```

Questions:
  * Let's say we no longer wish to print the number of outliers replaced - what would you change in the function?
  * Can you make the outliers take on 0 as a value instead of NA?

#### Outlier Removal with a Numerical Threshold 

```{r, cache=TRUE}
summary(edu_normalized$num_students_female)
edu_normalized <- outlierreplace(edu_normalized, 'num_students_female', (edu_normalized$num_students_female > 3000))
summary(edu_normalized$num_students_female)
```                        

Notice that multiple columns may be selected for the __outlierreplace()__ function to be applied to, just as there may be multiple variables in the `rowpredicate` conditions. 

```{r, echo=FALSE}
edu_normalized <- outlierreplace(edu_normalized, c('num_tchrs_total', 'num_students_total'),
                    (edu_normalized$num_tchrs_total > 20 & 
                         edu_normalized$num_students_total == 0))

edu_normalized <- outlierreplace(edu_normalized, 'num_js_female',
                                (edu_normalized$num_js_female > 1250 & 
                                 edu_normalized$num_classrms_total < 25 &
                                 edu_normalized$num_tchrs_total < 10))

```                        

Upon inspection of the summary statistics for certain columns, outliers may become obviously clear. 
```{r, cache=TRUE}
summary(edu_normalized$num_exercise_books_per_student_pry)
summary(edu_normalized$num_exercise_books_per_student_jss)
```

Question: 
  * Let's take a look at the __sample_data__ we worked with in previous trainings. Detect and eliminate any outliers for the `num_doctors_available` variable. Hint: if you get stuck about how to set the `rowpredicate` conditions, remember the `table()` function. 

#### A Graphical Example
To find a more precise threshold than the summary/table method, we can plot our data.
```{r, cache=TRUE}

```

